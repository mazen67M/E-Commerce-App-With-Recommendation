@model Ecommerce.Application.DTOs.Products.ProductDto

<!-- Modern Minimal Product Card -->
<div class="product-card-modern">
    <!-- Product Image -->
    <div class="product-image">
        <a asp-controller="Product" asp-action="Details" asp-route-id="@Model.ProductID">
            @if (!string.IsNullOrEmpty(Model.ImageURL))
            {
                <img src="@Model.ImageURL" alt="@Model.Name" loading="lazy">
            }
            else
            {
                <div class="d-flex align-items-center justify-content-center h-100">
                    <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                </div>
            }
        </a>
        
        <!-- Category Tag -->
        @if (!string.IsNullOrEmpty(Model.CategoryName))
        {
            <span class="category-tag">@Model.CategoryName</span>
        }
        
        <!-- Discount Badge -->
        @if (Model.DiscountPercentage > 0)
        {
            <span class="position-absolute top-2 start-2 badge bg-danger" style="top: 12px; left: 12px;">
                -@Model.DiscountPercentage%
            </span>
        }
        
        <!-- Out of Stock Overlay -->
        @if (!Model.IsAvailable)
        {
            <div class="position-absolute inset-0 bg-dark bg-opacity-50 d-flex align-items-center justify-content-center" 
                 style="top: 0; left: 0; right: 0; bottom: 0;">
                <span class="badge bg-dark">Out of Stock</span>
            </div>
        }
        
        <!-- Wishlist Button -->
        <button type="button" class="position-absolute btn btn-light btn-sm rounded-circle shadow-sm" 
                style="top: 12px; right: 52px; width: 36px; height: 36px;"
                onclick="toggleWishlist(@Model.ProductID)" title="Add to Wishlist">
            <i class="bi bi-heart"></i>
        </button>
    </div>
    
    <!-- Product Info -->
    <div class="product-info">
        <!-- Product Name -->
        <a asp-controller="Product" asp-action="Details" asp-route-id="@Model.ProductID" 
           class="text-decoration-none">
            <h6 class="product-name">@Model.Name</h6>
        </a>
        
        <!-- Rating -->
        <div class="product-rating">
            @for (int i = 1; i <= 5; i++)
            {
                @if (i <= Model.AverageRating)
                {
                    <i class="bi bi-star-fill"></i>
                }
                else if (i - 0.5 <= Model.AverageRating)
                {
                    <i class="bi bi-star-half"></i>
                }
                else
                {
                    <i class="bi bi-star"></i>
                }
            }
            @if (Model.ReviewCount > 0)
            {
                <span class="rating-count">(@Model.ReviewCount)</span>
            }
        </div>
        
        <!-- Price -->
        <div class="product-price">
            @if (Model.DiscountPercentage > 0)
            {
                <span class="text-decoration-line-through text-muted me-2" style="font-size: 0.85rem;">
                    @((Model.Price / (1 - Model.DiscountPercentage / 100)).ToString("N2")) L.E
                </span>
            }
            <span>@Model.Price.ToString("N2") L.E</span>
        </div>
        
        <!-- Action Buttons -->
        <div class="product-actions">
            @if (Model.IsAvailable)
            {
                <button type="button" class="btn-add-cart" onclick="addToCart(@Model.ProductID)">
                    Add to Cart
                </button>
                <a asp-controller="Checkout" asp-action="BuyNow" asp-route-productId="@Model.ProductID" 
                   class="btn-buy-now text-center text-decoration-none">
                    Buy Now
                </a>
            }
            else
            {
                <button type="button" class="btn-add-cart" disabled style="flex: 1; opacity: 0.5;">
                    Out of Stock
                </button>
            }
        </div>
    </div>
</div>

<script>
    function toggleWishlist(productId) {
        fetch(`/Profile/Wishlist/Toggle/${productId}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Toggle heart icon
                    event.target.classList.toggle('bi-heart');
                    event.target.classList.toggle('bi-heart-fill');
                    event.target.classList.toggle('text-danger');
                }
            })
            .catch(err => console.log('Wishlist error:', err));
    }
</script>
