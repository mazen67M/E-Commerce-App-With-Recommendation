@model HomeViewModel
@{
    ViewData["Title"] = "Home Page";
}

@Html.AntiForgeryToken()

<!-- Hero Section -->
<section class="hero-section text-white py-5 mb-5 position-relative overflow-hidden">
    <div class="hero-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
    </div>
    <div class="container position-relative" style="z-index: 2;">
        <div class="row align-items-center min-vh-60">
            <div class="col-lg-6 mb-4 mb-lg-0 slide-in-up">
                <span class="badge bg-warning text-dark mb-3 px-3 py-2 fs-6">
                    <i class="bi bi-stars me-1"></i>Special Offers Available
                </span>
                <h1 class="display-2 fw-bold mb-4 text-shadow">Welcome to <span class="text-warning">ShopSmart</span></h1>
                <p class="lead mb-4 fs-5">Discover amazing products at unbeatable prices. Shop the latest trends and enjoy fast, free shipping on all orders!</p>
                <div class="d-flex gap-3 flex-wrap">
                    <a asp-controller="Product" asp-action="Index" class="btn btn-warning btn-lg px-5 py-3 hover-lift shadow-lg">
                        <i class="bi bi-bag-fill me-2"></i>Shop Now
                    </a>
                    <a asp-controller="Product" asp-action="Featured" class="btn btn-outline-light btn-lg px-5 py-3 hover-lift">
                        <i class="bi bi-star-fill me-2"></i>Featured
                    </a>
                </div>
                <div class="mt-4 d-flex gap-4">
                    <div class="hero-stat">
                        <h3 class="fw-bold text-warning mb-0">10K+</h3>
                        <small class="text-white-50">Products</small>
                    </div>
                    <div class="hero-stat">
                        <h3 class="fw-bold text-warning mb-0">5K+</h3>
                        <small class="text-white-50">Happy Customers</small>
                    </div>
                    <div class="hero-stat">
                        <h3 class="fw-bold text-warning mb-0">24/7</h3>
                        <small class="text-white-50">Support</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 scale-in">
                <div class="hero-image-container">
                    <div class="floating-card">
                        <div class="hero-icon-wrapper">
                            <i class="bi bi-bag-heart-fill"></i>
                        </div>
                        <div class="hero-floating-badge badge-1">
                            <i class="bi bi-percent"></i>
                        </div>
                        <div class="hero-floating-badge badge-2">
                            <i class="bi bi-gift-fill"></i>
                        </div>
                        <div class="hero-floating-badge badge-3">
                            <i class="bi bi-truck"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Features Section -->
<section class="container mb-5">
    <div class="row g-4">
        <div class="col-md-4 scroll-reveal">
            <div class="feature-card">
                <div class="feature-card-icon feature-icon-shipping">
                    <i class="bi bi-truck"></i>
                </div>
                <div class="feature-card-content">
                    <h4 class="fw-bold mb-2">Free Shipping</h4>
                    <p class="text-muted mb-0">Free shipping on all orders over 500 L.E. Fast and reliable delivery.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 scroll-reveal" style="animation-delay: 0.1s;">
            <div class="feature-card">
                <div class="feature-card-icon feature-icon-secure">
                    <i class="bi bi-shield-lock-fill"></i>
                </div>
                <div class="feature-card-content">
                    <h4 class="fw-bold mb-2">Secure Payment</h4>
                    <p class="text-muted mb-0">Your payment information is encrypted and secure. Shop with confidence.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 scroll-reveal" style="animation-delay: 0.2s;">
            <div class="feature-card">
                <div class="feature-card-icon feature-icon-returns">
                    <i class="bi bi-arrow-counterclockwise"></i>
                </div>
                <div class="feature-card-content">
                    <h4 class="fw-bold mb-2">Easy Returns</h4>
                    <p class="text-muted mb-0">14-day return policy. Not satisfied? Return it hassle-free.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Quick Categories Section -->
<section class="container mb-5">
    <div class="text-center mb-4">
        <h2 class="display-6 fw-bold mb-2">Shop by Category</h2>
        <p class="text-muted">Explore our wide range of products</p>
    </div>
    <div class="row g-3">
        <div class="col-6 col-md-3">
            <a asp-controller="Product" asp-action="Index" asp-route-category="Electronics" class="text-decoration-none">
                <div class="category-quick-card">
                    <div class="category-quick-icon bg-primary-subtle">
                        <i class="bi bi-laptop text-primary"></i>
                    </div>
                    <span class="category-quick-label">Electronics</span>
                </div>
            </a>
        </div>
        <div class="col-6 col-md-3">
            <a asp-controller="Product" asp-action="Index" asp-route-category="Fashion" class="text-decoration-none">
                <div class="category-quick-card">
                    <div class="category-quick-icon bg-danger-subtle">
                        <i class="bi bi-bag text-danger"></i>
                    </div>
                    <span class="category-quick-label">Fashion</span>
                </div>
            </a>
        </div>
        <div class="col-6 col-md-3">
            <a asp-controller="Product" asp-action="Index" asp-route-category="Home" class="text-decoration-none">
                <div class="category-quick-card">
                    <div class="category-quick-icon bg-success-subtle">
                        <i class="bi bi-house-heart text-success"></i>
                    </div>
                    <span class="category-quick-label">Home & Living</span>
                </div>
            </a>
        </div>
        <div class="col-6 col-md-3">
            <a asp-controller="Product" asp-action="Index" asp-route-category="Sports" class="text-decoration-none">
                <div class="category-quick-card">
                    <div class="category-quick-icon bg-warning-subtle">
                        <i class="bi bi-bicycle text-warning"></i>
                    </div>
                    <span class="category-quick-label">Sports</span>
                </div>
            </a>
        </div>
    </div>
</section>

<!-- Featured Products Section -->
<section class="container mb-5">
    <div class="text-center mb-5 scroll-reveal">
        <h2 class="display-5 fw-bold mb-3">Featured Products</h2>
        <p class="lead text-muted">Check out our handpicked selection of trending products</p>
    </div>
    
    <div class="row g-4">
        @if (Model.FeaturedProducts != null && Model.FeaturedProducts.Any())
        {
            @foreach (var product in Model.FeaturedProducts)
            {
                <div class="col-lg-3 col-md-4 col-sm-6 scroll-reveal">
                    <div class="card h-100 shadow-sm product-card border-0 hover-lift">
                        <div class="position-relative image-zoom-container">
                            <a asp-controller="Product" asp-action="Details" asp-route-id="@product.ProductID">
                                @if (!string.IsNullOrEmpty(product.ImageURL))
                                {
                                    <img src="@product.ImageURL" class="card-img-top image-zoom" alt="@product.Name" style="height: 250px; object-fit: cover;">
                                }
                                else
                                {
                                    <div class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height: 250px;">
                                        <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                                    </div>
                                }
                            </a>
                            @if (!product.IsAvailable)
                            {
                                <div class="position-absolute top-0 end-0 m-2">
                                    <span class="badge bg-danger">Out of Stock</span>
                                </div>
                            }
                        </div>
                        <div class="card-body d-flex flex-column">
                            <div class="mb-2">
                                <span class="badge bg-light text-dark">@product.CategoryName</span>
                            </div>
                            <h5 class="card-title mb-2">
                                <a asp-controller="Product" asp-action="Details" asp-route-id="@product.ProductID" class="text-decoration-none text-dark">
                                    @product.Name
                                </a>
                            </h5>
                            @if (product.AverageRating > 0)
                            {
                                <div class="mb-2">
                                    <div class="d-flex align-items-center">
                                        @for (int i = 1; i <= 5; i++)
                                        {
                                            @if (i <= product.AverageRating)
                                            {
                                                <i class="bi bi-star-fill text-warning small"></i>
                                            }
                                            else
                                            {
                                                <i class="bi bi-star text-muted small"></i>
                                            }
                                        }
                                        <small class="text-muted ms-2">(@product.AverageRating.ToString("F1"))</small>
                                    </div>
                                </div>
                            }
                            <div class="mt-auto pt-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h4 class="text-primary mb-0 price-tag fw-bold">@product.Price.ToString("N2") L.E</h4>
                                </div>
                                @if (product.IsAvailable)
                                {
                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-primary flex-grow-1" onclick="addToCart(@product.ProductID)" title="Add to Cart">
                                            <i class="bi bi-cart-plus"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-danger wishlist-btn" onclick="toggleWishlist(@product.ProductID, this)" data-product-id="@product.ProductID" title="Add to Wishlist">
                                            <i class="bi bi-heart"></i>
                                        </button>
                                        <a asp-controller="Product" asp-action="Details" asp-route-id="@product.ProductID" class="btn btn-outline-primary" title="View Details">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                    </div>
                                }
                                else
                                {
                                    <button class="btn btn-secondary w-100" disabled>
                                        <i class="bi bi-x-circle"></i> Out of Stock
                                    </button>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-12">
                <div class="empty-state">
                    <i class="bi bi-box-seam"></i>
                    <h4 class="text-muted">No featured products available</h4>
                    <p class="text-muted">Check back soon for amazing deals!</p>
                </div>
            </div>
        }
    </div>
    
    <div class="text-center mt-5">
        <a asp-controller="Product" asp-action="Index" class="btn btn-outline-primary btn-lg px-5 hover-lift">
            <i class="bi bi-grid me-2"></i>View All Products
        </a>
    </div>
</section>

<!-- Newsletter Section -->
<section class="newsletter-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h2 class="display-6 fw-bold mb-3">Stay Updated</h2>
                <p class="lead mb-4">Subscribe to our newsletter and get exclusive deals delivered to your inbox!</p>
                <form class="d-flex gap-2 justify-content-center flex-wrap">
                    <input type="email" class="form-control newsletter-input" placeholder="Enter your email" style="max-width: 400px;">
                    <button type="submit" class="btn newsletter-btn">
                        <i class="bi bi-envelope me-2"></i>Subscribe
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        // Add staggered animation delays to product cards
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.product-card');
            cards.forEach((card, index) => {
                card.parentElement.style.animationDelay = `${index * 0.1}s`;
            });
        });

        // Add to cart function
        function addToCart(productId) {
            $.ajax({
                url: '@Url.Action("AddToCart", "Product")',
                type: 'POST',
                data: { productId: productId, quantity: 1 },
                headers: {
                    'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                },
                success: function(response) {
                    if (response.success) {
                        showNotification('Product added to cart!', 'success');
                        updateCartCount();
                    } else {
                        if (response.message && response.message.includes('authenticated')) {
                            showNotification('Please login to add items to cart', 'warning');
                            setTimeout(() => window.location.href = '@Url.Action("Login", "Account")', 1500);
                        } else {
                            showNotification(response.message || 'Failed to add to cart', 'error');
                        }
                    }
                },
                error: function() {
                    showNotification('Failed to add product to cart', 'error');
                }
            });
        }

        // Toggle wishlist function
        function toggleWishlist(productId, button) {
            const icon = button.querySelector('i');
            const isFilled = icon.classList.contains('bi-heart-fill');
            
            $.ajax({
                url: '@Url.Action("ToggleWishlist", "Product")',
                type: 'POST',
                data: { productId: productId },
                headers: {
                    'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                },
                success: function(response) {
                    if (response.success) {
                        if (response.isInWishlist) {
                            icon.classList.remove('bi-heart');
                            icon.classList.add('bi-heart-fill');
                            button.classList.remove('btn-outline-danger');
                            button.classList.add('btn-danger');
                            showNotification('Added to wishlist!', 'success');
                        } else {
                            icon.classList.remove('bi-heart-fill');
                            icon.classList.add('bi-heart');
                            button.classList.remove('btn-danger');
                            button.classList.add('btn-outline-danger');
                            showNotification('Removed from wishlist', 'info');
                        }
                    } else {
                        if (response.message && response.message.includes('authenticated')) {
                            showNotification('Please login to manage wishlist', 'warning');
                            setTimeout(() => window.location.href = '@Url.Action("Login", "Account")', 1500);
                        } else {
                            showNotification(response.message || 'Failed to update wishlist', 'error');
                        }
                    }
                },
                error: function() {
                    showNotification('Failed to update wishlist', 'error');
                }
            });
        }

        // Update cart count
        function updateCartCount() {
            $.ajax({
                url: '@Url.Action("GetCartCount", "Cart")',
                type: 'GET',
                success: function(count) {
                    const badge = document.getElementById('cartCount');
                    if (badge) {
                        badge.textContent = count;
                        if (count > 0) {
                            badge.classList.remove('d-none');
                        }
                    }
                }
            });
        }

        // Show notification
        function showNotification(message, type) {
            const alertClass = type === 'success' ? 'alert-success' : 
                             type === 'error' ? 'alert-danger' : 
                             type === 'warning' ? 'alert-warning' : 'alert-info';
            
            const notification = $(`
                <div class="alert ${alertClass} alert-dismissible fade show position-fixed" 
                     style="top: 20px; right: 20px; z-index: 9999; min-width: 300px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `);
            
            $('body').append(notification);
            
            setTimeout(function() {
                notification.alert('close');
            }, 3000);
        }
    </script>
}

@section Styles {
    <style>
        /* Hero Section Enhancements */
        .hero-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .shape {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 20s infinite ease-in-out;
        }

        .shape-1 {
            width: 300px;
            height: 300px;
            top: -100px;
            right: -100px;
            animation-delay: 0s;
        }

        .shape-2 {
            width: 200px;
            height: 200px;
            bottom: -50px;
            left: 10%;
            animation-delay: 5s;
        }

        .shape-3 {
            width: 150px;
            height: 150px;
            top: 50%;
            right: 20%;
            animation-delay: 10s;
        }

        @@keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(180deg); }
        }

        .text-shadow {
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }

        .min-vh-60 {
            min-height: 60vh;
        }

        .hero-image-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .floating-card {
            position: relative;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            padding: 3rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: floatCard 6s ease-in-out infinite;
        }

        @@keyframes floatCard {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        /* Wishlist button states */
        .wishlist-btn.btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }

        .wishlist-btn.btn-danger:hover {
            background-color: #bb2d3b;
            border-color: #b02a37;
        }
    </style>
}